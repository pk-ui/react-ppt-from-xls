{"ast":null,"code":"const XmlStream = require('../../../utils/xml-stream');\n\nconst BaseXform = require('../base-xform');\n\nconst ListXform = require('../list-xform');\n\nconst AutoFilterXform = require('./auto-filter-xform');\n\nconst TableColumnXform = require('./table-column-xform');\n\nconst TableStyleInfoXform = require('./table-style-info-xform');\n\nclass TableXform extends BaseXform {\n  constructor() {\n    super();\n    this.map = {\n      autoFilter: new AutoFilterXform(),\n      tableColumns: new ListXform({\n        tag: 'tableColumns',\n        count: true,\n        empty: true,\n        childXform: new TableColumnXform()\n      }),\n      tableStyleInfo: new TableStyleInfoXform()\n    };\n  }\n\n  prepare(model, options) {\n    this.map.autoFilter.prepare(model);\n    this.map.tableColumns.prepare(model.columns, options);\n  }\n\n  get tag() {\n    return 'table';\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n    xmlStream.openNode(this.tag, { ...TableXform.TABLE_ATTRIBUTES,\n      id: model.id,\n      name: model.name,\n      displayName: model.displayName || model.name,\n      ref: model.tableRef,\n      totalsRowCount: model.totalsRow ? '1' : undefined,\n      totalsRowShown: model.totalsRow ? undefined : '1',\n      headerRowCount: model.headerRow ? '1' : '0'\n    });\n    this.map.autoFilter.render(xmlStream, model);\n    this.map.tableColumns.render(xmlStream, model.columns);\n    this.map.tableStyleInfo.render(xmlStream, model.style);\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n\n    const name = node.name,\n          attributes = node.attributes;\n\n    switch (name) {\n      case this.tag:\n        this.reset();\n        this.model = {\n          name: attributes.name,\n          displayName: attributes.displayName || attributes.name,\n          tableRef: attributes.ref,\n          totalsRow: attributes.totalsRowCount === '1',\n          headerRow: attributes.headerRowCount === '1'\n        };\n        break;\n\n      default:\n        this.parser = this.map[node.name];\n\n        if (this.parser) {\n          this.parser.parseOpen(node);\n        }\n\n        break;\n    }\n\n    return true;\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n\n      return true;\n    }\n\n    switch (name) {\n      case this.tag:\n        this.model.autoFilterRef = this.map.autoFilter.model.autoFilterRef;\n        this.model.columns = this.map.tableColumns.model;\n        this.map.autoFilter.model.columns.forEach((column, index) => {\n          this.model.columns[index].filterButton = column.filterButton;\n        });\n        this.model.style = this.map.tableStyleInfo.model;\n        return false;\n\n      default:\n        // could be some unrecognised tags\n        return true;\n    }\n  }\n\n  reconcile(model, options) {\n    // fetch the dfxs from styles\n    model.columns.forEach(column => {\n      if (column.dxfId !== undefined) {\n        column.style = options.styles.getDxfStyle(column.dxfId);\n      }\n    });\n  }\n\n}\n\nTableXform.TABLE_ATTRIBUTES = {\n  'xmlns': 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\n  'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\n  'mc:Ignorable': 'xr xr3',\n  'xmlns:xr': 'http://schemas.microsoft.com/office/spreadsheetml/2014/revision',\n  'xmlns:xr3': 'http://schemas.microsoft.com/office/spreadsheetml/2016/revision3' // 'xr:uid': '{00000000-000C-0000-FFFF-FFFF00000000}',\n\n};\nmodule.exports = TableXform;","map":null,"metadata":{},"sourceType":"script"}