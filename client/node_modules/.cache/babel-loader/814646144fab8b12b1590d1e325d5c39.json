{"ast":null,"code":"const colCache = require('../../../utils/col-cache');\n\nconst BaseXform = require('../base-xform');\n\nconst VIEW_STATES = {\n  frozen: 'frozen',\n  frozenSplit: 'frozen',\n  split: 'split'\n};\n\nclass SheetViewXform extends BaseXform {\n  get tag() {\n    return 'sheetView';\n  }\n\n  prepare(model) {\n    switch (model.state) {\n      case 'frozen':\n      case 'split':\n        break;\n\n      default:\n        model.state = 'normal';\n        break;\n    }\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openNode('sheetView', {\n      workbookViewId: model.workbookViewId || 0\n    });\n\n    const add = function (name, value, included) {\n      if (included) {\n        xmlStream.addAttribute(name, value);\n      }\n    };\n\n    add('rightToLeft', '1', model.rightToLeft === true);\n    add('tabSelected', '1', model.tabSelected);\n    add('showRuler', '0', model.showRuler === false);\n    add('showRowColHeaders', '0', model.showRowColHeaders === false);\n    add('showGridLines', '0', model.showGridLines === false);\n    add('zoomScale', model.zoomScale, model.zoomScale);\n    add('zoomScaleNormal', model.zoomScaleNormal, model.zoomScaleNormal);\n    add('view', model.style, model.style);\n    let topLeftCell;\n    let xSplit;\n    let ySplit;\n    let activePane;\n\n    switch (model.state) {\n      case 'frozen':\n        xSplit = model.xSplit || 0;\n        ySplit = model.ySplit || 0;\n        topLeftCell = model.topLeftCell || colCache.getAddress(ySplit + 1, xSplit + 1).address;\n        activePane = model.xSplit && model.ySplit && 'bottomRight' || model.xSplit && 'topRight' || 'bottomLeft';\n        xmlStream.leafNode('pane', {\n          xSplit: model.xSplit || undefined,\n          ySplit: model.ySplit || undefined,\n          topLeftCell,\n          activePane,\n          state: 'frozen'\n        });\n        xmlStream.leafNode('selection', {\n          pane: activePane,\n          activeCell: model.activeCell,\n          sqref: model.activeCell\n        });\n        break;\n\n      case 'split':\n        if (model.activePane === 'topLeft') {\n          model.activePane = undefined;\n        }\n\n        xmlStream.leafNode('pane', {\n          xSplit: model.xSplit || undefined,\n          ySplit: model.ySplit || undefined,\n          topLeftCell: model.topLeftCell,\n          activePane: model.activePane\n        });\n        xmlStream.leafNode('selection', {\n          pane: model.activePane,\n          activeCell: model.activeCell,\n          sqref: model.activeCell\n        });\n        break;\n\n      case 'normal':\n        if (model.activeCell) {\n          xmlStream.leafNode('selection', {\n            activeCell: model.activeCell,\n            sqref: model.activeCell\n          });\n        }\n\n        break;\n\n      default:\n        break;\n    }\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    switch (node.name) {\n      case 'sheetView':\n        this.sheetView = {\n          workbookViewId: parseInt(node.attributes.workbookViewId, 10),\n          rightToLeft: node.attributes.rightToLeft === '1',\n          tabSelected: node.attributes.tabSelected === '1',\n          showRuler: !(node.attributes.showRuler === '0'),\n          showRowColHeaders: !(node.attributes.showRowColHeaders === '0'),\n          showGridLines: !(node.attributes.showGridLines === '0'),\n          zoomScale: parseInt(node.attributes.zoomScale || '100', 10),\n          zoomScaleNormal: parseInt(node.attributes.zoomScaleNormal || '100', 10),\n          style: node.attributes.view\n        };\n        this.pane = undefined;\n        this.selections = {};\n        return true;\n\n      case 'pane':\n        this.pane = {\n          xSplit: parseInt(node.attributes.xSplit || '0', 10),\n          ySplit: parseInt(node.attributes.ySplit || '0', 10),\n          topLeftCell: node.attributes.topLeftCell,\n          activePane: node.attributes.activePane || 'topLeft',\n          state: node.attributes.state\n        };\n        return true;\n\n      case 'selection':\n        {\n          const name = node.attributes.pane || 'topLeft';\n          this.selections[name] = {\n            pane: name,\n            activeCell: node.attributes.activeCell\n          };\n          return true;\n        }\n\n      default:\n        return false;\n    }\n  }\n\n  parseText() {}\n\n  parseClose(name) {\n    let model;\n    let selection;\n\n    switch (name) {\n      case 'sheetView':\n        if (this.sheetView && this.pane) {\n          model = this.model = {\n            workbookViewId: this.sheetView.workbookViewId,\n            rightToLeft: this.sheetView.rightToLeft,\n            state: VIEW_STATES[this.pane.state] || 'split',\n            // split is default\n            xSplit: this.pane.xSplit,\n            ySplit: this.pane.ySplit,\n            topLeftCell: this.pane.topLeftCell,\n            showRuler: this.sheetView.showRuler,\n            showRowColHeaders: this.sheetView.showRowColHeaders,\n            showGridLines: this.sheetView.showGridLines,\n            zoomScale: this.sheetView.zoomScale,\n            zoomScaleNormal: this.sheetView.zoomScaleNormal\n          };\n\n          if (this.model.state === 'split') {\n            model.activePane = this.pane.activePane;\n          }\n\n          selection = this.selections[this.pane.activePane];\n\n          if (selection && selection.activeCell) {\n            model.activeCell = selection.activeCell;\n          }\n\n          if (this.sheetView.style) {\n            model.style = this.sheetView.style;\n          }\n        } else {\n          model = this.model = {\n            workbookViewId: this.sheetView.workbookViewId,\n            rightToLeft: this.sheetView.rightToLeft,\n            state: 'normal',\n            showRuler: this.sheetView.showRuler,\n            showRowColHeaders: this.sheetView.showRowColHeaders,\n            showGridLines: this.sheetView.showGridLines,\n            zoomScale: this.sheetView.zoomScale,\n            zoomScaleNormal: this.sheetView.zoomScaleNormal\n          };\n          selection = this.selections.topLeft;\n\n          if (selection && selection.activeCell) {\n            model.activeCell = selection.activeCell;\n          }\n\n          if (this.sheetView.style) {\n            model.style = this.sheetView.style;\n          }\n        }\n\n        return false;\n\n      default:\n        return true;\n    }\n  }\n\n  reconcile() {}\n\n}\n\nmodule.exports = SheetViewXform;","map":null,"metadata":{},"sourceType":"script"}