{"ast":null,"code":"const TextXform = require('./text-xform');\n\nconst RichTextXform = require('./rich-text-xform');\n\nconst PhoneticTextXform = require('./phonetic-text-xform');\n\nconst BaseXform = require('../base-xform'); // <si>\n//   <r></r><r></r>...\n// </si>\n// <si>\n//   <t></t>\n// </si>\n\n\nclass SharedStringXform extends BaseXform {\n  constructor(model) {\n    super();\n    this.model = model;\n    this.map = {\n      r: new RichTextXform(),\n      t: new TextXform(),\n      rPh: new PhoneticTextXform()\n    };\n  }\n\n  get tag() {\n    return 'si';\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openNode(this.tag);\n\n    if (model && model.hasOwnProperty('richText') && model.richText) {\n      const r = this.map.r;\n      model.richText.forEach(text => {\n        r.render(xmlStream, text);\n      });\n    } else if (model !== undefined && model !== null) {\n      this.map.t.render(xmlStream, model);\n    }\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    const name = node.name;\n\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n\n    if (name === this.tag) {\n      this.model = {};\n      return true;\n    }\n\n    this.parser = this.map[name];\n\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n\n    return false;\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        switch (name) {\n          case 'r':\n            {\n              let rt = this.model.richText;\n\n              if (!rt) {\n                rt = this.model.richText = [];\n              }\n\n              rt.push(this.parser.model);\n              break;\n            }\n\n          case 't':\n            this.model = this.parser.model;\n            break;\n\n          default:\n            break;\n        }\n\n        this.parser = undefined;\n      }\n\n      return true;\n    }\n\n    switch (name) {\n      case this.tag:\n        return false;\n\n      default:\n        return true;\n    }\n  }\n\n}\n\nmodule.exports = SharedStringXform;","map":null,"metadata":{},"sourceType":"script"}